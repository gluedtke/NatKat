---
title: "Applying Bayes’ Rule to Natural Hazards, Risks, and Disasters"
author: "Sina Spors, Gwendolin Lüdtke"
date: "18. February 2019"
output:
  html_document:
    highlight: textmate
    code_folding: show
    theme: spacelab #cerulean, journal, flatly, darkly, readable, spacelab, united, cosmo, lumen, paper, sandstone,                       simplex, and yet
    toc: true #add table of contents, possible to modify toc_depth: 1-3
    toc_float: #floating table of contents will always be visible even when the document is scrolled
      collapsed: false #controls whether the TOC appears with only the top-level (e.g., H2) headers. If collapsed                            initially, the TOC is automatically expanded inline when necessary
      smooth_scroll: true #controls whether page scrolls are animated when TOC items are navigated to via mouse                                 clicks
      
#Alternative: html_notebook
---

<style>
body {
text-align: justify} 
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Basics

Natural hazards are severe and extreme weather and climate events that occur naturally in all parts of the world, although some regions are more vulnerable to certain hazards than others. Statistically, natural hazards can be described as a probability (or frequency) of the natural process per year. Vulnerability can be explained as a percentage loss of value. The loss can be in different areas auch as socioeconomic, political, structural or ecological. Risks arise from the overlapping of danger and vulnerability. In general, the hazard can be described by the intensity and probability of extreme events. Statistically risk can be describes as the annual expected loss in terms of financial resources.

## Bayesian Rule and its variables

In order to be able to quantify all these values, the so-called **Bayes' Rule** is appropriate. It was developed by the english mathematician Thomas Bayes and describes a probabilistic theory that deals with the calculation of conditional probabilities. The Bayes Rule extends the original assumption by constantly recording new data and observations. Probability is a measure of subjective uncertainty. Mathematically, the Bayes Rule can be described as follows:

$$P(A|B)=\frac{P(B|A)*P(A)}{P(B)}$$

B discribes the given data that we observed and A are the things we wish to learn from it. 
In order to work actively with this probabilistic theory, certain parameters must first be determined. The three parameters in focus are likelihood, prior, and posterior. The Bayes Rule can also written in words: 

$$Posterior=\frac{Likelihood*Prior}{Evidence}$$

**Likelihood** discribes a function that depends on the model setup (parameters) given that we observe data. Prior and Posterior are always distributions. 

**Prior** is a probability distribution that would express one's beliefs about this quantity before some evidence is taken into account. 

In Bayesian statistic the **posterior** is a conditional probability. After the relevant evidence or background is taken into account the prior is refered. Depending on evidence obtained through an experiment or survey, the probability distribution of an unknown quantity may be considered as a random variable.

## 20 Studies

In order to understand the definition and context of the variables just given, 20 self-selected studies have been prepared. For this purpose, a table with phenomena (natural hazard), likelihood, prior and references was created.

Number|Phenomena|Likelihood|Prior|References|
|:-:|:-:|:-:|:-:|:-:|
|1|x|x|x|x|
|2|x|x|x|x|
|3|x|x|x|x|
|4|x|x|x|x|
|5|x|x|x|x|
|6|x|x|x|x|
|7|x|x|x|x|
|8|x|x|x|x|
|9|x|x|x|x|
|10|x|x|x|x|
|11|x|x|x|x|
|12|x|x|x|x|
|13|x|x|x|x|
|14|x|x|x|x|
|15|x|x|x|x|
|16|x|x|x|x|
|17|x|x|x|x|
|18|x|x|x|x|
|19|x|x|x|x|
|20|x|x|x|x|

In this simple exercise, it becomes clear that the prior can assume different distributions. But for the introduction into the chosen topic, this serves for a better understanding. 

## Examples

In order to understand the procedure and the various ways of using the Bayes Rule, three examples are presented in the following section. These deal with three different distribution always with reference to the Bayes Rule. The given data can be both invented and scientifically proven.

### Poisson Distribution

For the following example of a Poisson Distribution in connection with the Bayes Rule, the theme of the tropical cyclones is used. As there has been an increasing number of publications in recent years, focusing on the topic of tropical cyclones. In particular, the thesis was discussed as to whether these have increased in frequency and strength over the course of time.

In order to calculate the mean rate of events from a data set that contains the number of counts of these events in a fixed time interval you have to use the Poisson distribution in combination with the Bayes’ Rule. The Poisson distribution is a discrete probability distribution that is used for the calculation of the probability of a given number of events in a specified interval (known expectation rate) assuming that these events are independent. (The values in this example are not based on scientific findings and are therefore fictitious)

To calculate the posterior rate (bayes rule) vectors are used instead of static or interactive individual values. For this purpose, the already known equation of the Bayes Rule is used and the various parameters are defined:

$$p(\lambda|D)=\frac{p(D|\lambda) p(\lambda)}{p(D)}$$
with:
 
* D = yearly number of tropical cyclones
  
* $\lambda$ = means
 
First, we need to define the prior input, that is, the number of tropical cyclones that have occurred in the northern Atlantic area over the last 10 years. Thus, the minimum and maximum annual tropical cyclones are determined

```{r}
cyclones <- c(9, 13, 8, 3, 10, 6, 13, 15, 16, 14)


min <- min(cyclones)
max <- max(cyclones)
```
```{r, echo = FALSE}
cat("Minimum: ", min)
cat("Maximum: ", max)
```

The next step is to define a range for the rate. The lower limit of prior is set to 0 since years without tropical cyclones are possible. Due to the maximum  value of our data, the upper limit is set to 80. Therefore we need to define a variable with a range from 0 to 80, to ensure a variable with at least 80 values. This results in the following vector: 

```{r}
prior <- 0:79 # define 80 values

plot(prior, type = "h",
     main = "Annual Number of Tropical Cyclones",
     xlab = "Index",
     ylab = "Prior",
     lwd = 2)
```

It is assumed that the values for $\lambda$ are all equally probable. Thus it is possible to calculate a discrete uniform probability distribution (Prior). For this, the probabilities are considered and repeated independently.

```{r}
prior_prob <- rep(1/length(prior),times = length(prior)) 

# plot the discrete uniform probability distribution
plot(prior_prob, type="h", 
     main = "Prior", 
     xlab ="Annual rate of tropical cyclones", 
     ylab = "Probability of occurring a tropical cyclone", 
     lwd = 2)
```

In the following step, the Poisson Distribution is now multiplied for each $\lambda$ mean to define the likelihood. It should be noted that the events are all independent of each other. The Poisson distribution is calculated by using the function ```dpois()```. The vector containing the yearly number of tropical cyclones as well as the prior-vector (means) are the input values. We use a loop where the minimum and maximum lambda values are the limits. This is determined by ```seq_along```. The diagram shows that the probability settles to a concrete value. This is caused by the Poisson Distribution since the probabilities are all independent of each other. (The most likely values are striking)

```{r}
#p(D|lambda) = Likelihood
#create a vector with the same number of entries as in "prior"
likeli <- rep(NA,length(prior))

#using a loop for the calculation
for (i in seq_along(prior))
{
  likeli[i] <- prod(dpois(cyclones,i))
}

plot(likeli,type ="h", 
     main = "Likelihood", 
     xlab ="Annual number of tropical cyclones", 
     ylab = "Likelihood", 
     lwd = 2)
```

In order to calculate the Posterior rate, according to the Bayes theorem, it is necessary to multiply the likelihood with the prior and divide the result by the evidence. The evidence can be expressed by the sum of all possible outcomes (renormalization).

```{r}
# Posterior
bayes_rate <- likeli * prior_prob
bayes_rate <- bayes_rate/ sum(bayes_rate)

plot(bayes_rate, type = "h", 
     main = "Posterior", 
     xlab ="Annual number of tropical cyclones", 
     ylab = "Posterior", 
     lwd = 2)
abline(v = 11, lty = 2, lwd = 2, col = "red")
legend(60, 0.2, legend=c("most likely rate"),
       col=c("red"), lty=2, lwd = 1, cex=0.8)
which(c(bayes_rate) == max (bayes_rate))
```

